<?xml version="1.0" encoding="utf-8"?>
<Workflow WorkflowId="{119a619d-f75d-4a8a-a3ff-a224142180f7}" Name="Process Invoice Request - Update Status" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <JsonFileName>/Workflows/ProcessInvoiceRequest-UpdateStatus-119A619D-F75D-4A8A-A3FF-A224142180F7.json</JsonFileName>
  <Type>1</Type>
  <Subprocess>0</Subprocess>
  <Category>6</Category>
  <Mode>0</Mode>
  <Scope>4</Scope>
  <OnDemand>0</OnDemand>
  <TriggerOnCreate>0</TriggerOnCreate>
  <TriggerOnDelete>0</TriggerOnDelete>
  <AsyncAutodelete>0</AsyncAutodelete>
  <SyncWorkflowLogOnFailure>0</SyncWorkflowLogOnFailure>
  <StateCode>1</StateCode>
  <StatusCode>2</StatusCode>
  <RunAs>1</RunAs>
  <IsTransacted>1</IsTransacted>
  <IntroducedVersion>1.0.0.0</IntroducedVersion>
  <IsCustomizable>1</IsCustomizable>
  <UIFlowType>2</UIFlowType>
  <IsCustomProcessingStepAllowedForOtherPublishers>1</IsCustomProcessingStepAllowedForOtherPublishers>
  <Metadata>{"clientversion":"2.43.204.24107","isvalid":true,"$schema":"https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#","schemaVersion":"ROBIN_20211012","containsActiveConnections":false,"containsGptPredictActions":false,"containsActiveCopilotActions":false,"containsActiveWorkQueuesActions":false,"containsActiveLogMessageActions":false,"multipleRequestsState":0,"scriptType":0,"disableScreenshotCaptureOnError":false,"flowTimeout":null}</Metadata>
  <Inputs>{"schema":{"required":["dataverse_username","dataverse_password","dataverse_tenant","dataverse_baseurl","dataverse_client_id","dataverse_secret"],"properties":{"dataverse_username":{"isOptional":false,"default":"","description":"","format":"password","title":"dataverse_username","type":"string","value":null},"dataverse_password":{"isOptional":false,"default":"","description":"","format":"password","title":"dataverse_password","type":"string","value":null},"dataverse_tenant":{"isOptional":false,"default":"","description":"","format":null,"title":"dataverse_tenant","type":"string","value":"b446b8ee-6e20-4988-ad71-58e4aca2a7f9"},"dataverse_baseurl":{"isOptional":false,"default":"","description":"","format":null,"title":"dataverse_baseurl","type":"string","value":"https://orga2a0a858.crm5.dynamics.com"},"dataverse_client_id":{"isOptional":false,"default":"","description":"","format":"password","title":"dataverse_client_id","type":"string","value":null},"dataverse_secret":{"isOptional":false,"default":"","description":"","format":"password","title":"dataverse_secret","type":"string","value":null}},"type":"object"}}</Inputs>
  <Outputs>{"schema":null}</Outputs>
  <Dependencies>{"childFlows":[],"workQueues":[]}</Dependencies>
  <ConnectionReferences>[]</ConnectionReferences>
  <Definition>"@@ConnectionString: ''\r\n@@Type: 'Local'\r\n@@DesktopType: 'local'\r\n@@DisplayName: 'Local computer'\r\nIMPORT 'controlRepo.appmask' AS appmask\r\nIMPORT 'imageRepo.imgrepo' AS imgrepo\r\n@SENSITIVE: [dataverse_username, dataverse_password, AuthenticationResponseJson, dataverse_token, dataverse_client_id, dataverse_secret]\r\n@INPUT dataverse_username : { 'Description': '', 'FriendlyName': 'dataverse_username', 'Type': 'String', 'IsOptional': False, 'DefaultValue': 'demo.presenter@DemoPP003.onmicrosoft.com' } \r\n@INPUT dataverse_password : { 'Description': '', 'FriendlyName': 'dataverse_password', 'Type': 'String', 'IsOptional': False, 'DefaultValue': '' } \r\n@INPUT dataverse_tenant : { 'Description': '', 'FriendlyName': 'dataverse_tenant', 'Type': 'String', 'IsOptional': False, 'DefaultValue': 'b446b8ee-6e20-4988-ad71-58e4aca2a7f9' } \r\n@INPUT dataverse_baseurl : { 'Description': '', 'FriendlyName': 'dataverse_baseurl', 'Type': 'String', 'IsOptional': False, 'DefaultValue': 'https://orga2a0a858.crm5.dynamics.com' } \r\n@INPUT dataverse_client_id : { 'Description': '', 'FriendlyName': 'dataverse_client_id', 'Type': 'String', 'IsOptional': False, 'DefaultValue': 'defe7f35-7328-4040-ba34-baaf1b239b78' } \r\n@INPUT dataverse_secret : { 'Description': '', 'FriendlyName': 'dataverse_secret', 'Type': 'String', 'IsOptional': False, 'DefaultValue': '' } \r\nCALL 'Dataverse with Client Cred Auth'\r\n# Get a List of Invoice Requests\r\nWeb.InvokeWebService.InvokeWebService Url: $'''%dataverse_baseurl%/api/data/v9.2/mss_processinvoicerequests?$filter=mss_referencenumber eq \\'0001\\'''' Method: Web.Method.Get Accept: $'''*/*''' ContentType: $'''application/json''' CustomHeaders: $'''Authorization:Bearer %dataverse_token%''' ConnectionTimeout: 30 FollowRedirection: True ClearCookies: False FailOnErrorStatus: False EncodeRequestBody: False UserAgent: $'''Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.21) Gecko/20100312 Firefox/3.6''' Encoding: Web.Encoding.AutoDetect AcceptUntrustedCertificates: False Response=&gt; GetPIRResponse StatusCode=&gt; StatusCode2\r\nVariables.ConvertJsonToCustomObject Json: GetPIRResponse CustomObject=&gt; InvoiceRequestsObject\r\nLOOP FOREACH CurrentInvoiceRequest IN InvoiceRequestsObject.value\r\n    # Update each request\r\n    Web.InvokeWebService.InvokeWebService Url: $'''%dataverse_baseurl%/api/data/v9.2/mss_processinvoicerequests(%CurrentInvoiceRequest.mss_processinvoicerequestid%)''' Method: Web.Method.Patch Accept: $'''application/json''' ContentType: $'''application/json''' CustomHeaders: $'''Authorization:Bearer %dataverse_token%''' RequestBody: $'''{\\\"mss_approvalcomments\\\" : \\\"approving 0001\\\"}''' ConnectionTimeout: 30 FollowRedirection: True ClearCookies: False FailOnErrorStatus: False EncodeRequestBody: False UserAgent: $'''Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.21) Gecko/20100312 Firefox/3.6''' Encoding: Web.Encoding.AutoDetect AcceptUntrustedCertificates: False StatusCode=&gt; StatusCode3\r\nEND\r\nFUNCTION 'Dataverse with Password Auth' GLOBAL\r\n    Web.InvokeWebService.InvokeWebService Url: $'''https://login.microsoftonline.com/%dataverse_tenant%/oauth2/v2.0/token''' Method: Web.Method.Post Accept: $'''*/*''' ContentType: $'''application/x-www-form-urlencoded''' RequestBody: $'''grant_type=password&amp;client_id=2ad88395-b77d-4561-9441-d0e40824f9bc&amp;username=%dataverse_username%&amp;password=%dataverse_password%&amp;scope=%dataverse_baseurl%//user_impersonation''' ConnectionTimeout: 30 FollowRedirection: True ClearCookies: False FailOnErrorStatus: False EncodeRequestBody: False UserAgent: $'''Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.21) Gecko/20100312 Firefox/3.6''' Encoding: Web.Encoding.AutoDetect AcceptUntrustedCertificates: False Response=&gt; AuthenticationResponse StatusCode=&gt; StatusCode\r\n    Variables.ConvertJsonToCustomObject Json: AuthenticationResponse CustomObject=&gt; AuthenticationResponseJson\r\n    SET dataverse_token TO AuthenticationResponseJson.access_token\r\nEND FUNCTION\r\nFUNCTION 'Dataverse with Client Cred Auth' GLOBAL\r\n    Web.InvokeWebService.InvokeWebService Url: $'''https://login.microsoftonline.com/%dataverse_tenant%/oauth2/v2.0/token''' Method: Web.Method.Post Accept: $'''*/*''' ContentType: $'''application/x-www-form-urlencoded''' RequestBody: $'''grant_type=client_credentials&amp;client_id=%dataverse_client_id%&amp;client_secret=%dataverse_secret%&amp;scope=%dataverse_baseurl%/.default''' ConnectionTimeout: 30 FollowRedirection: True ClearCookies: False FailOnErrorStatus: False EncodeRequestBody: False UserAgent: $'''Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.21) Gecko/20100312 Firefox/3.6''' Encoding: Web.Encoding.AutoDetect AcceptUntrustedCertificates: False Response=&gt; AuthenticationResponse StatusCode=&gt; StatusCode\r\n    Variables.ConvertJsonToCustomObject Json: AuthenticationResponse CustomObject=&gt; AuthenticationResponseJson\r\n    SET dataverse_token TO AuthenticationResponseJson.access_token\r\nEND FUNCTION\r\n"</Definition>
  <SchemaVersion>2022.07</SchemaVersion>
  <DesktopFlowModules>[]</DesktopFlowModules>
  <PrimaryEntity>none</PrimaryEntity>
  <LocalizedNames>
    <LocalizedName languagecode="1033" description="Process Invoice Request - Update Status" />
  </LocalizedNames>
</Workflow>